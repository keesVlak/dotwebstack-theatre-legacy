L.TileLayer.WMTS=L.TileLayer.extend({defaultWmtsParams:{service:"WMTS",request:"GetTile",version:"1.0.0",layers:"",styles:"",tilematrixSet:"",format:"image/jpeg"},initialize:function(b,a){this._url=b;var d=L.extend({},this.defaultWmtsParams);var e=a.tileSize||this.options.tileSize;if(a.detectRetina&&L.Browser.retina){d.width=d.height=e*2}else{d.width=d.height=e}for(var c in a){if(!this.options.hasOwnProperty(c)&&c!="matrixIds"){d[c]=a[c]}}this.wmtsParams=d;this.matrixIds=a.matrixIds||this.getDefaultMatrix();L.setOptions(this,a)},onAdd:function(a){this._crs=this.options.crs||a.options.crs;L.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(h){var l=this.options.tileSize;var j=h.multiplyBy(l);j.x+=1;j.y-=1;var i=j.add(new L.Point(l,l));var m=this._tileZoom;var e=this._crs.project(this._map.unproject(j,m));var f=this._crs.project(this._map.unproject(i,m));tilewidth=f.x-e.x;var d=this.matrixIds[m].identifier;var b=this.matrixIds[m].topLeftCorner.lng;var k=this.matrixIds[m].topLeftCorner.lat;var g=Math.floor((e.x-b)/tilewidth);var c=-Math.floor((e.y-k)/tilewidth);var a=L.Util.template(this._url,{s:this._getSubdomain(h)});return a+L.Util.getParamString(this.wmtsParams,a)+"&tilematrix="+d+"&tilerow="+c+"&tilecol="+g},setParams:function(b,a){L.extend(this.wmtsParams,b);if(!a){this.redraw()}return this},getDefaultMatrix:function(){var b=new Array(22);for(var a=0;a<22;a++){b[a]={identifier:""+a,topLeftCorner:new L.LatLng(903402,-285401.92)}}return b}});L.tileLayer.wmts=function(b,a){return new L.TileLayer.WMTS(b,a)};